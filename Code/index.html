<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <script src='d3.v4.min.js'></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900" rel="stylesheet">
    <script src="https://use.fontawesome.com/b0f0c8766a.js"></script>
    <link rel="icon" href="favicon-smile-o.ico">
</head>

<body>
    <div id="content-wrapper">
        <div id="content">
            <!-- svg plot here -->
            <div id="plot-container" class="content-card">
                <div class="mask mask-top"></div>
                <div class="mask mask-right"></div>
            </div>
            <div id="message-container" class=" content-card">
                <div id="message-body">
                    <p id="message-text"></p>
                </div>
                <div id="navigation-bar">
                    <button id="check-answer-button" class="button button-check grey">
                        Check Answer
                    </button>
                    <button id="next-button" class="button green inactive">
                        <i class="fa fa-arrow-right" aria-hidden="true"></i>
                    </button>
                    <br>
                </div>

            </div>

        </div>

        <div id="tool-bar" class='content-card'>
            <span class="tool-bar-item">
                <span class="information-box">
                    <span class="information-icon">
                        <i class="fa fa-question" aria-hidden="true"></i>
                    </span>
                    <span class="information-content">A
                        <b>correlation line</b> indicates the statistical relationship between independent and dependent variables.</span>
                </span>
                Correlation Line
                <input id='trend-line-checkbox' type='checkbox'>
                <span id='pcc-text'></span>
            </span>
            <span class="tool-bar-item">
                <span class="information-box">
                    <span class="information-icon">
                        <i class="fa fa-question" aria-hidden="true"></i>
                    </span>
                    <span class="information-content">A
                        <b>chart line</b> represents data in a series. Data points are connected with straight lines. This visualization
                        indicates an ordered relationship between points.</span>
                </span>
                Chart Line
                <input id='chart-lines-checkbox' type='checkbox'>
            </span>
            <span class="tool-bar-item">
                <span class="information-box">
                    <span class="information-icon">
                        <i class="fa fa-question" aria-hidden="true"></i>
                    </span>
                    <span class="information-content">The
                        <b>box plot</b> is a way to represent the distribution of data. You can display box plots for x and
                        y values separately.</span>
                </span>
                Box plot
                <input id='quartile-checkbox' type='checkbox'>
                <select id='quartile-mode'>
                    <option id="quartile-mode-0" value="0">Minimal</option>
                    <option id="quartile-mode-1" value="1">Box &amp whisker X</option>
                    <option id="quartile-mode-2" value="2">Box &amp whisker Y</option>
                    <option id="quartile-mode-3" value="3">Box &amp whisker X &amp Y</option>
                </select>
            </span>
            <br>
            <br>
            <br>

            <span class='tool-bar-item'>
                <span class="information-box">
                    <span class="information-icon">
                        <i class="fa fa-question" aria-hidden="true"></i>
                    </span>
                    <span class="information-content">The
                        <b>domain</b> of the plot is the set of all x values in the graph. X values are independent variables.</span>
                </span>
                Domain
                <input type="range" class="slider" id="domain-slider">
            </span>
            <span class='tool-bar-item'>
                <span class="information-box">
                    <span class="information-icon">
                        <i class="fa fa-question" aria-hidden="true"></i>
                    </span>
                    <span class="information-content">The
                        <b>range</b> of the plot is the set of all y values in the graph. Y values are dependent variables.</span>
                </span>
                Range
                <input type="range" class="slider" id="range-slider">
            </span>
        </div>

        <div id="footer">
            <span class="footer-element">
                <a target="_blank" href="mailto:jackbreidy@gmail.com">JACK REIDY</a>
            </span>
            <span class="footer-element">
                <a target="_blank" href="https://drive.google.com/open?id=1EF7PJApFflYqIW9ZXfLWI0noW2gOPbBx">FILES</a>
            </span>
            <span class="footer-element">
                <a target="_blank" href="https://docs.google.com/document/d/1e6SW6l7uFbuB_V3ri6DKxb01DCmzeto_Yh5lyHqk4bk/edit?usp=sharing">PAPER</a>
            </span>
            <span class="footer-element">
                <a target="_blank" href="https://magrawala.github.io/cs448b-fa17/">CS 448B</a>
            </span>
        </div>
    </div>
</body>

</html>

<style>
    body {
        font-family: 'Roboto', sans-serif;
        background-color: #dcdcdc;
    }

    .tool-bar-item {
        margin-right: 25px;
    }

    .content-card {
        overflow: hidden;
        display: inline-block;
        background-color: #fff;
        /* -webkit-box-shadow: 0px 3px 5px -4px rgba(0, 0, 0, 0.75);
        -moz-box-shadow: 0px 3px 5px -4px rgba(0, 0, 0, 0.75);
        box-shadow: 0px 3px 5px -4px rgba(0, 0, 0, 0.75); */
    }

    #content-wrapper {
        text-align: center;
    }

    #content {
        margin-top: 40px;
    }

    #plot-container {
        border-radius: 5px 0px 0px 5px;
        margin-right: -4px;
        max-height: 700px;
    }

    #plot-background {
        fill: #fff;
    }

    .plot-mask {
        fill: #fff;
        background-color: #fff;
    }

    #message-container {
        border-radius: 0px 5px 5px 0px;
        width: 400px;
        height: 700px;
        position: relative;
    }

    #message-body {
        margin-top: 40px;
        margin-left: 15px;
        text-align: left;
    }

    #message-header {
        font-weight: 500;
        font-size: 1.5em;
    }

    #message-text {
        overflow-y: auto;
        padding-right: 35px;
        max-height: 565px;
    }

    .message-text-with-skip {
        max-height: 515px !important;
    }

    @media screen and (max-width: 1150px) {
        #plot-container {
            border-radius: 5px;
            margin-right: 0;
        }
        #message-container {
            margin-top: 20px;
            width: 700px;
            height: 400px;
            border-radius: 5px;
        }
        #message-body {
            margin-left: 0;
        }
        #message-text {
            padding-left: 35px;
            max-height: 265px;
        }
        .message-text-with-skip {
            max-height: 215px !important;
        }
        #tool-bar {
            width: 700px !important;
        }
    }

    #navigation-bar {
        position: absolute;
        bottom: 0;
        margin-bottom: 30px;
        width: 100%;
    }

    #tool-bar {
        padding-top: 50px;
        padding-bottom: 50px;
        width: 1100px;
        margin-top: 20px;
        border-radius: 5px;
        overflow: initial;
    }

    #footer {
        margin-top: 35px;
        margin-bottom: 35px;
        font-weight: 500;
        font-size: 0.9em;
        text-decoration: none;
        color: #494949;
    }

    #footer a:link {
        text-decoration: none;
        color: inherit;
    }

    #footer a:visited {
        text-decoration: none;
        color: inherit;
    }

    #footer .footer-element {
        margin: 15px;
    }

    .button {
        background-color: #494949;
        display: inline-block;
        text-align: center;
        color: #fff;
        padding: 20px;
        padding-top: 10px;
        padding-bottom: 10px;
        text-decoration: none;
        font-size: 1.0em;
        margin: 5px;
        margin-bottom: 0px;
        margin-top: 0px;
        border: none;
        pointer-events: visible;
        cursor: pointer;
        font-family: 'Roboto', sans-serif;
        border-radius: 5px;
        font-weight: 300;
        outline: none;
    }

    .button:hover {
        filter: brightness(85%);
    }

    .button-check {
        width: 72%;
    }

    .button-skip {
        margin-bottom: 11px;
        width: calc(72.5% + 66px);
        margin-left: 2px;
    }

    .button-next-hover {
        filter: brightness(85%);
    }

    .button-quiz {
        margin-top: 12px;
        margin-left: 0;
    }

    .grey {
        background-color: #494949;
    }

    .green {
        background-color: #43C477;
    }

    .red {
        background-color: #FB565E;
    }

    .inactive {
        pointer-events: none;
        background-color: #ACACAC;
        color: #fff;
    }

    path {
        fill: none;
        stroke: #000;
    }

    .point {
        fill: #4682b4;
        stroke: #12548A;
        stroke-width: 2.0;
    }

    .uneditable-point {
        fill: #787878;
        stroke: #494949;
    }

    .editable-point {
        fill: #4682b4;
        stroke: #12548A;
        cursor: pointer;
    }

    .correct-point {
        fill: #58b446;
        stroke: rgb(18, 138, 24);
        cursor: pointer;
    }

    .chart-line {
        stroke: #aac6dc;
        stroke-width: 1.5;
        pointer-events: none;
    }

    .trend-line {
        stroke-dasharray: 15 15;
        stroke: #777;
        stroke-width: 1.5;
        pointer-events: none;
    }

    .grid-line {
        stroke-dasharray: 5 5;
        stroke: #ccc;
        stroke-width: 1.5;
        pointer-events: none;
    }

    .text-rect {
        fill: #ffffffe1;
        -webkit-filter: drop-shadow(0px 2px 1.1px rgba(0, 0, 0, 0.25));
        filter: drop-shadow(0px 2px 1.1px rgba(0, 0, 0, 0.25));
        pointer-events: none;
    }

    .point-value-text {
        fill: #000;
        font-family: sans-serif;
        pointer-events: none;
    }

    .quartile-minimal {
        fill: none;
        stroke: #000;
        stroke-width: 1.5;
        pointer-events: none;
    }

    .quartile-line {
        stroke-width: 1.5;
        stroke: #000;
    }

    .quartile-line-median {
        stroke: #000;
    }

    .axis {
        stroke-width: 1.5;
        font-size: 0.7em;
        pointer-events: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    .point-text {
        font-size: 10px;
        font-family: sans-serif;
        pointer-events: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    .quartile-box {
        fill: #eee;
        stroke-width: 1.5;
        stroke: #000;
        pointer-events: none;
    }

    .delete-rect {
        fill: #FF5858;
        cursor: pointer;
    }

    .delete-rect:hover {
        fill: #BF1313;
    }

    .delete-text {
        fill: #fff;
        font-weight: 500;
        font-size: 0.8em;
        pointer-events: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    .add-rect {
        fill: #58b446;
        cursor: pointer;
    }

    .add-rect:hover {
        fill: #237B10;
    }

    .add-temp-circle {
        fill: #787878;
    }

    .add-text {
        fill: #fff;
        font-weight: 500;
        font-size: 0.8em;
        pointer-events: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    .slider {
        width: 200px;
        position: relative;
        top: 6px;
    }

    .mask {
        background: #fff;
        position: absolute;
    }

    .mask-top {
        margin-left: 5px;
        width: 690px;
        height: 95px;
    }

    .mask-right {
        margin-top: 5px;
        margin-left: 609px;
        width: 91px;
        height: 690px;
    }

    .information-box {
        font-size: 0.8em;
        margin-right: 5px;
        position: relative;
        display: inline-block;
    }

    .information-icon {
        text-align: center;
        border-radius: 3px;
        color: #fff;
        padding: 3px;
        padding-left: 5px;
        padding-right: 6px;
        background: #c17777;
    }

    .information-content {
        font-size: 1.1em !important;
        color: #000;
        font-size: 0.7em;
        text-align: left;
        visibility: hidden;
        position: absolute;
        z-index: 1;
        left: -145px;
        margin-left: -60%;
        min-width: 300px;
        background: #fff;
        padding: 20px;
        bottom: 100%;
        margin-bottom: 20px;
        border-radius: 5px;
        box-shadow: 0px 2px 1.1px rgba(0, 0, 0, 0.25);
    }

    .information-box:hover .information-content {
        visibility: visible;
    }
</style>

<script>

    let url = new URL(window.location.href);

    let quizID = +url.searchParams.get('quizid');
    let pageIndex = +url.searchParams.get('pageindex');
    let pageLoadFailed = true;

    let dataFileName;
    let quizType;
    let pageTextHTML;
    let quartileQuizIndex;
    let correlationQuizIndex;
    let nextUrl;

    let quizActive = false;
    if (quizID != 0) {
        quizActive = true;
    }

    if (quizID == 1) {
        pageLoadFailed = false;
        switch (pageIndex) {
            case 0:
                dataFileName = "data/quartile-question-1.csv";
                quizType = 0;
                quartileQuizIndex = 6;
                nextUrl = "https://jackbereidy.github.io/CS448B_Final_Project/Code/index.html?quizid=1&pageindex=1";
                pageTextHTML = '<span id="message-header">Box plot quiz</span><br><br> Move the <span style="font-weight: 700;color:#4682b4">blue</span> point so that it\'s y value is the <b>maximum</b> of the Box plot.<br><br>Notice that changes to the x value of the point do not change the Box plot. You might remember that this is because this Box plot represents the distribution of y values.<br><br>When you find a valid position, check your answer to unlock the next question.'
                d3.select('#message-text').html(pageTextHTML);
                d3.csv(dataFileName, parseInputRow, loadData);
                break;
            case 1:
                dataFileName = "data/quartile-question-2.csv";
                quizType = 0;
                quartileQuizIndex = 2;
                nextUrl = "https://jackbereidy.github.io/CS448B_Final_Project/Code/index.html?quizid=1&pageindex=2";
                pageTextHTML = '<span id="message-header">Box plot quiz</span><br><br> Move the <span style="font-weight: 700;color:#4682b4">blue</span> point so that it\'s y value is in the <b>second quartile</b> of the Box plot.<br><br>Notice that changes to the x value of the point do not change the Box plot. You might remember that this is because this Box plot represents the distribution of y values.<br><br>When you find a valid position, check your answer to unlock the next question.'
                d3.select('#message-text').html(pageTextHTML);
                d3.csv(dataFileName, parseInputRow, loadData);
                break;
            case 2:
                dataFileName = "data/quartile-question-3.csv";
                quizType = 0;
                quartileQuizIndex = 3;
                nextUrl = "https://jackbereidy.github.io/CS448B_Final_Project/Code/index.html?quizid=1&pageindex=3";
                pageTextHTML = '<span id="message-header">Box plot quiz</span><br><br> Move the <span style="font-weight: 700;color:#4682b4">blue</span> point so that it\'s y value is the <b>median</b> of the Box plot.<br><br>Notice that changes to the x value of the point do not change the Box plot. You might remember that this is because this Box plot represents the distribution of y values.<br><br>When you find a valid position, check your answer to unlock the next question.'
                d3.select('#message-text').html(pageTextHTML);
                d3.csv(dataFileName, parseInputRow, loadData);
                break;
            case 3:
                dataFileName = "data/quartile-question-4.csv";
                quizType = 0;
                quartileQuizIndex = 4;
                nextUrl = "https://jackbereidy.github.io/CS448B_Final_Project/Code/index.html";
                pageTextHTML = '<span id="message-header">Box plot quiz</span><br><br> Move the <span style="font-weight: 700;color:#4682b4">blue</span> point so that it\'s y value is in the <b>third quartile</b> of the Box plot.<br><br>Notice that changes to the x value of the point do not change the Box plot. You might remember that this is because this Box plot represents the distribution of y values.<br><br>When you find a valid position, check your answer to unlock the next question.'
                d3.select('#message-text').html(pageTextHTML);
                d3.csv(dataFileName, parseInputRow, loadData);
                break;
            default:
                // load home page
                break;
        }
    } else if (quizID == 2) {
        pageLoadFailed = false;
        switch (pageIndex) {
            case 0:

                dataFileName = "data/correlation-question-1.csv";
                quizType = 1;
                correlationQuizIndex = 0;
                nextUrl = "https://jackbereidy.github.io/CS448B_Final_Project/Code/index.html?quizid=2&pageindex=1";
                pageTextHTML = '<span id="message-header">Correlation plot quiz</span><br><br> Move the <span style="font-weight: 700;color:#4682b4">blue</span> points so that the data shows <b>positive correlation</b>.<br><br>When you find a valid position, check your answer to unlock the next question.'
                d3.select('#message-text').html(pageTextHTML);
                d3.csv(dataFileName, parseInputRow, loadData);
                break;
            case 1:
                dataFileName = "data/correlation-question-2.csv";
                quizType = 1;
                correlationQuizIndex = 1;
                nextUrl = "https://jackbereidy.github.io/CS448B_Final_Project/Code/index.html?quizid=2&pageindex=2";
                pageTextHTML = '<span id="message-header">Correlation plot quiz</span><br><br> Move the <span style="font-weight: 700;color:#4682b4">blue</span> points so that the data shows <b>weak or no correlation</b>.<br><br>When you find a valid position, check your answer to unlock the next question.'
                d3.select('#message-text').html(pageTextHTML);
                d3.csv(dataFileName, parseInputRow, loadData);
                break;
            case 2:
                dataFileName = "data/correlation-question-3.csv";
                quizType = 1;
                correlationQuizIndex = 2;
                nextUrl = "https://jackbereidy.github.io/CS448B_Final_Project/Code/index.html";
                pageTextHTML = '<span id="message-header">Correlation plot quiz</span><br><br> Move the <span style="font-weight: 700;color:#4682b4">blue</span> points so that the data shows a <b>negative correlation</b>.<br><br>When you find a valid position, check your answer to unlock the next question.'
                d3.select('#message-text').html(pageTextHTML);
                d3.csv(dataFileName, parseInputRow, loadData);
                break;
            default:
                // load home page
                break;
        }
    } else {
        dataFileName = "data/empty.csv";
        pageTextHTML = '<span id="message-header">Scatter plot tool</span><br><br> Add points by clicking inside the graph. Points can be moved by dragging them with the mouse. Points can be deleted by selecting and then clicking <b>x</b>.<br><br>Plot settings can be enabled and modified in the control panel below.<br><br> If you want a challenge, try a quiz:'
        pageTextHTML += '<br><button id="correlation-button" class="button button-quiz grey">Correlation quiz</button><br>';
        pageTextHTML += '<button id="box-plot-button" class="button button-quiz grey">Box plot quiz</button>';
        d3.select('#message-text').html(pageTextHTML);
        d3.select('#navigation-bar').remove();
        d3.csv(dataFileName, parseInputRow, loadData);
    }

    function parseInputRow(d) {
        return {
            id: +d.id,
            isEditable: +d.isEditable == 1,
            x: +d.x,
            y: +d.y,
            isSolution: +d.isSolution == 1,
        };
    }

    let plotWidth = 500;
    let plotHeight = 500;
    let plotMargin = 100;
    let outerWidth = plotWidth + 2 * plotMargin;
    let outerHeight = plotHeight + 2 * plotMargin;

    let chartMinX = 0;
    let chartCurrentX = 10;
    let chartMinY = 0;
    let chartCurrentY = 10;
    let chartMaxPossible = 100;


    let wholePlot = d3.select('#plot-container').append('svg')
        .attr('width', outerWidth)
        .attr('height', outerHeight)
        .attr('id', 'whole-chart');


    let plot = wholePlot.append('g')
        .attr('id', 'plot')
        .attr('transform', `translate(${plotMargin},${plotMargin})`);

    let plotBackground;

    let points = plot.append('g')
        .attr('id', 'points');

    let xScale = d3.scaleLinear()
        .domain([chartMinX, chartCurrentX])
        .range([0, plotWidth]);
    let yScale = d3.scaleLinear()
        .domain([chartMinY, chartCurrentY])
        .range([plotHeight, 0]);

    let xAxis = plot.append('g')
        .attr('transform', `translate(0,${plotHeight})`)
        .attr('id', 'x-axis')
        .attr('class', 'axis')
        .call(d3.axisBottom(xScale));
    let yAxis = plot.append('g')
        .attr('id', 'y-axis')
        .attr('class', 'axis')
        .call(d3.axisLeft(yScale));
    updateAxisStyle(xAxis, true);
    updateAxisStyle(yAxis, false);

    let xQuartiles = plot.append('g')
        .attr('id', 'x-quartiles');
    let yQuartiles = plot.append('g')
        .attr('id', 'y-quartiles');

    let boxAndWhiskerElementsX = xQuartiles.append('g')
        .attr('transform', `translate(0, 40)`)
        .attr('class', 'boxAndWhiskerElements');
    let boxAndWhiskerElementsY = yQuartiles.append('g')
        .attr('transform', `translate(-40,0)`)
        .attr('class', 'boxAndWhiskerElements');

    let lowExtremeX = createQuartilePlotElement(boxAndWhiskerElementsX, true, true, false, false, "");
    let highExtremeX = createQuartilePlotElement(boxAndWhiskerElementsX, true, true, false, false, "");
    let lowerQuartileX = createQuartilePlotElement(boxAndWhiskerElementsX, true, false, false, true, "x-box-1");
    let upperQuartileX = createQuartilePlotElement(boxAndWhiskerElementsX, true, false, false, false, "");
    let medianX = createQuartilePlotElement(boxAndWhiskerElementsX, true, false, true, true, "x-box-2");

    let lowExtremeY = createQuartilePlotElement(boxAndWhiskerElementsY, false, true, false, false, "");
    let highExtremeY = createQuartilePlotElement(boxAndWhiskerElementsY, false, true, false, false, "");
    let lowerQuartileY = createQuartilePlotElement(boxAndWhiskerElementsY, false, false, false, false, "");
    let upperQuartileY = createQuartilePlotElement(boxAndWhiskerElementsY, false, false, false, true, "y-box-2");
    let medianY = createQuartilePlotElement(boxAndWhiskerElementsY, false, false, true, true, "y-box-1");

    let minimalElementsX = xQuartiles.append('g')
        .attr('class', 'minimalElements');
    minimalElementsX.append('line')
        .attr("class", "quartile-minimal line-0");
    minimalElementsX.append('line')
        .attr("class", "quartile-minimal line-1");
    minimalElementsX.append('line')
        .attr("class", "quartile-minimal line-2");
    minimalElementsX.append('line')
        .attr("class", "quartile-minimal line-3");

    let minimalElementsY = yQuartiles.append('g')
        .attr('class', 'minimalElements');
    minimalElementsY.append('line')
        .attr("class", "quartile-minimal line-0");
    minimalElementsY.append('line')
        .attr("class", "quartile-minimal line-1");
    minimalElementsY.append('line')
        .attr("class", "quartile-minimal line-2");
    minimalElementsY.append('line')
        .attr("class", "quartile-minimal line-3");

    let boxAndWhiskerLineX = lowExtremeX.append('line')
        .attr('id', 'box-and-whisker-line-x')
        .attr('class', 'quartile-line')
        .attr('y1', '0')
        .attr('y2', '0');

    let boxAndWhiskerLineY = lowExtremeY.append('line')
        .attr('id', 'box-and-whisker-line-y')
        .attr('class', 'quartile-line')
        .attr('x1', '0')
        .attr('x2', '0');

    let xBox1 = d3.select('#x-box-1');
    let xBox2 = d3.select('#x-box-2');
    let yBox1 = d3.select('#y-box-1');
    let yBox2 = d3.select('#y-box-2');

    let currentQuartileMode = 0;

    let pointData;

    let trendLineActive;
    let chartLinesActive;
    let quartileActive;

    function createMinimalQuartilePlotElement(group, isOuter) {
        let minimalGroup = quartile.append('g')
            .attr('class', 'minimalElement');
        let minimalLine = minimalGroup.append('line')
            .attr('class', 'minimal-line')
            .attr('x1', 0)
            .attr('x2', 1)
            .attr('y1', 0)
            .attr('y2', 0)
            .attr('stroke', '#100');
    }

    function createQuartilePlotElement(group, isHorizontal, isExtreme, isMedian, hasBox, boxAndWhiskerString) {
        let boxAndWhisker = group.append('g')
            .attr('transform', `translate(0,${plotHeight})`)
            .attr('class', 'boxAndWhiskerElement');
        let line = boxAndWhisker.append('line')
            .attr('class', 'quartile-line')
            .attr('x1', -6.25)
            .attr('x2', 6.25)
            .attr('y1', 0)
            .attr('y2', 0);
        if (hasBox) {
            let box = boxAndWhisker.append('rect')
                .attr('x', 0)
                .attr('y', -12.5)
                .attr('width', 10)
                .attr('height', 25)
                .attr('class', 'quartile-box')
                .attr('id', boxAndWhiskerString);
            if (!isHorizontal) box.attr('transform', `rotate(90)`);
        }
        if (isHorizontal) line.attr('transform', `rotate(90)`);
        if (isMedian) line.attr('class', 'quartile-line-median');

        if (!isExtreme) {
            line.attr('x1', -12.5)
                .attr('x2', 12.5);
        }
        return boxAndWhisker;
    }

    function loadData(error, data) {
        if (error) throw error;
        pointData = data;
        plotBackground = plot.append('rect')
            .attr('id', 'plot-background')
            .attr('x', 0)
            .attr('y', 0)
            .attr('width', plotWidth)
            .attr('height', plotHeight)
            .on('mousedown', displayAddRect);
        setUpState();
        drawUpdatedScatterPlot(data);
        drawSecondaryPlotElements();

    }

    function drawUpdatedScatterPlot(data) {

        pointData = data;

        let circles = points.selectAll('g.point-group');

        let updatedCircles = circles.data(pointData, d => d.id);

        let enterSelection = updatedCircles.enter();
        let newCircles = enterSelection.append('g')
            .attr('id', function (d) { return 'point-group-' + d.id; })
            .attr('class', function (d) { return 'point-group ' + ((d.isEditable) ? 'editable-point-group' : 'uneditable-point-group') });
        newCircles.append('circle')
            .attr('class', function (d) { return 'point ' + ((d.isEditable) ? 'editable-point' : 'uneditable-point') })
            .attr('r', 5)
            .attr('cx', function (d) { return xScale(d.x); })
            .attr('cy', function (d) { return yScale(d.y); })
            .call(d3.drag()
                .subject(function () {
                    var t = d3.select(this);
                    return { x: t.attr('cx'), y: t.attr('cy') };
                })
                .on('start', onPointDrag)
                .on('drag', onPointDrag)
                .on('end', function (d) {
                    displayDeleteButton(d);
                    updatePointInfoVisibility(d, false);
                    updatePointGridVisibility(d, true, false);
                }))
            .on('mouseover', function (d) {
                plot.select('#point-group-' + d.id).moveToFront();
                updatePointInfoVisibility(d, true);
                updatePointGridVisibility(d, false, true);
            })
            .on('mouseout', function (d) {
                updatePointInfoVisibility(d, false);
                updatePointGridVisibility(d, false, false);
            })
            .on('click', function (d) {

            });

        let text = newCircles.append('text')
            .attr('class', 'point-value-text')
            .attr('x', function (d) { return xScale(d.x); })
            .attr('y', function (d) { return yScale(d.y) - 15; })
            .text(function (d) { return getPointValueText(d) });

        let textRect = newCircles.append('rect')
            .attr('class', 'text-rect')
            .attr('x', function (d) { return xScale(d.x) - 17.5; })
            .attr('y', function (d) { return yScale(d.y) - 40; })
            .attr('width', 35)
            .attr('height', 25)
            .moveToBack();

        let deleteText = newCircles.append('text')
            .attr('class', 'delete-text')
            .attr('visibility', 'visible')
            .attr('x', function (d) { return xScale(d.x) - 3.4; })
            .attr('y', function (d) { return yScale(d.y) + 22.2; })
            .text('x')
            .moveToBack();

        let deleteRect = newCircles.append('rect')
            .attr('width', 15)
            .attr('height', 15)
            .attr('rx', 2)
            .attr('visibility', 'visible')
            .attr('x', function (d) { return xScale(d.x) - 7.5; })
            .attr('y', function (d) { return yScale(d.y) + 10; })
            .attr('class', 'delete-rect')
            .on('click', function (d, i) {
                deleteDataElement(d, i);
            })
            .moveToBack();

        let gridLines = newCircles.append('g').attr('id', function (d) { return 'grid-lines-group-' + d.id });

        gridLines.append("line")
            .attr('x1', xScale(0))
            .attr('y1', function (d) { return yScale(d.y); })
            .attr('x2', function (d) { return xScale(d.x); })
            .attr('y2', function (d) { return yScale(d.y); })
            .attr('id', function (d) { return 'x-line-' + d.id; })
            .attr('class', 'grid-line');

        gridLines.append("line")
            .attr('x1', function (d) { return xScale(d.x); })
            .attr('y1', plotHeight)
            .attr('x2', function (d) { return xScale(d.x); })
            .attr('y2', function (d) { return yScale(d.y); })
            .attr('id', function (d) { return 'y-line-' + d.id; })
            .attr('class', 'grid-line');


        text.attr('visibility', 'hidden');
        textRect.attr('visibility', 'hidden');
        deleteText.attr('visibility', 'hidden');
        deleteRect.attr('visibility', 'hidden');
        gridLines.attr('visibility', 'hidden');

        let unselectedCircles = updatedCircles.exit();

        updatedCircles.exit().remove();

        xAxis.moveToBack();
        yAxis.moveToBack();
    }
    let dragPointGridVisibility = false;
    let hoverPointGridVisibility = false;
    let numGridLinesActive = 0;
    function updatePointGridVisibility(d, isDrag, visible) {
        if (isDrag == true) {
            dragPointGridVisibility = visible;
        } else {
            hoverPointGridVisibility = visible;
        }
        let lineGrids = plot.select('#grid-lines-group-' + d.id);
        if ((dragPointGridVisibility || hoverPointGridVisibility) && numGridLinesActive == 0) {
            lineGrids.attr('visibility', 'visible');
            numGridLinesActive++;
        } else if (!dragPointGridVisibility && !hoverPointGridVisibility) {
            lineGrids.attr('visibility', 'hidden');
            numGridLinesActive--;
        }
        lineGrids.moveToBack();
    }
    function addDataElement(pointPos) {
        let x = pointPos[0];
        let y = pointPos[1];
        let newPointId = 0;
        pointData.forEach(function (d) {
            if (d.id >= newPointId) newPointId = d.id + 1;
        });

        let newPoint = {
            id: newPointId,
            isEditable: 1,
            x: x,
            y: y,
            isSolution: 0,
        };
        pointData.push(newPoint);
        drawUpdatedScatterPlot(pointData);
        drawSecondaryPlotElements();
    }
    let addTimeout;
    function displayAddRect() {
        if (!quizActive) {
            clearTimeout(addTimeout);
            d3.selectAll('.add-group').remove();

            let mousePos = d3.mouse(this);
            let x = xScale.invert(mousePos[0]);
            let y = yScale.invert(mousePos[1]);

            let addGroup = plot.append('g')
                .attr('class', 'add-group');

            addGroup.append('rect')
                .attr('width', 15)
                .attr('height', 15)
                .attr('rx', 2)
                .attr('visibility', 'visible')
                .attr('x', function (d) { return xScale(x) - 7.5; })
                .attr('y', function (d) { return yScale(y) + 10; })
                .attr('class', 'add-rect')
                .on('click', function (d, i) {
                    addDataElement([x, y]);
                    d3.selectAll('.add-group').remove();
                });
            addGroup.append('text')
                .attr('class', 'add-text')
                .attr('visibility', 'visible')
                .attr('x', function (d) { return xScale(x) - 3.6; })
                .attr('y', function (d) { return yScale(y) + 22.2; })
                .text('+');

            addGroup.append('circle')
                .attr('class', 'add-temp-circle')
                .attr('r', 2.5)
                .attr('cx', function (d) { return xScale(x); })
                .attr('cy', function (d) { return yScale(y); });

            addTimeout = setTimeout(function () {
                d3.selectAll('.add-group').remove();
            }, 1500);
        }
    }
    function removeAllAddRemoveButtons() {
        d3.selectAll('.add-group').remove();
        points.selectAll('.delete-text').attr('visibility', 'hidden');
        points.selectAll('.delete-rect').attr('visibility', 'hidden');
    }
    function deleteDataElement(d, i) {
        let filteredData = pointData;
        filteredData = filteredData.filter(function (dataPoint) {
            return dataPoint.id != d.id;
        });
        drawUpdatedScatterPlot(filteredData);
        drawSecondaryPlotElements();
    }
    let deleteTimeout;
    let lastPointIndex;
    function displayDeleteButton(d) {
        if (!quizActive) {
            if (lastPointIndex == d.id) clearTimeout(deleteTimeout);
            lastPointIndex = +d.id;
            let pointGroup = plot.select('#point-group-' + d.id);
            pointGroup.select('.delete-text').attr('visibility', 'visible');
            pointGroup.select('.delete-rect').attr('visibility', 'visible');
            deleteTimeout = setTimeout(function (d) {
                pointGroup.select('.delete-text').attr('visibility', 'hidden');
                pointGroup.select('.delete-rect').attr('visibility', 'hidden');
            }, 2000);
        }
    }
    function updatePointInfoVisibility(d, isVisible) {
        let pointGroup = plot.select('#point-group-' + d.id);
        let text = pointGroup.select('.point-value-text')
            .text(getPointValueText(d));

        let dim = text.node().getBBox();
        text.attr('x', function (d) { return xScale(d.x) - (dim.width) / 2; })
            .attr('y', function (d) { return yScale(d.y) - (dim.height + 20 + 10 - 5) / 2; });
        let textRect = pointGroup.select('.text-rect')
            .attr('width', dim.width + 20)
            .attr('height', dim.height + 20)
            .attr('x', function (d) { return xScale(d.x) - (dim.width + 20) / 2; })
            .attr('y', function (d) { return yScale(d.y) - (dim.height + 20 + 10); })

        let deleteText = pointGroup.select('.delete-text')
            .attr('x', function (d) { return xScale(d.x) - 3.4; })
            .attr('y', function (d) { return yScale(d.y) - 13.6; });

        let deleteRect = pointGroup.select('.delete-rect')
            .attr('x', function (d) { return xScale(d.x) - 7.5; })
            .attr('y', function (d) { return yScale(d.y) - 25; });

        if (isVisible) {
            pointGroup.select('.point-value-text').attr('visibility', 'visible');
            pointGroup.select('.text-rect').attr('visibility', 'visible');

        } else {
            pointGroup.select('.point-value-text').attr('visibility', 'hidden');
            pointGroup.select('.text-rect').attr('visibility', 'hidden');
        }

    }
    function onPointDrag(d) {
        let pointGroup = plot.select('#point-group-' + d.id);
        updatePointGridVisibility(d, true, true);
        if (pointGroup.classed("editable-point-group")) {
            pointGroup.moveToFront();
            let dragPoint = pointGroup.select('.point');
            dragPoint.attr('cy', function (d) {
                if (yScale.invert(d3.event.y) < chartMinY) {
                    d.y = chartMinY;
                    return yScale(chartMinY);
                } else if (yScale.invert(d3.event.y) > chartCurrentY) {
                    d.y = chartCurrentY;
                    return yScale(chartCurrentY);
                } else {
                    d.y = yScale.invert(d3.event.y);
                    return d3.event.y;
                }
            })
                .attr('cx', function (d) {
                    if (xScale.invert(d3.event.x) < chartMinX) {
                        d.x = chartMinX;
                        return xScale(chartMinX);
                    } else if (xScale.invert(d3.event.x) > chartCurrentX) {
                        d.x = chartCurrentX;
                        return xScale(chartCurrentX);
                    } else {
                        d.x = xScale.invert(d3.event.x);
                        return d3.event.x;
                    }
                })

            updateGridLineLocationForPoint(d);

            updatePointInfoVisibility(d, true);
            drawSecondaryPlotElements(pointData);
        }

    }
    function updateGridLineLocationForPoint(d) {
        let gridLines = plot.select('#grid-lines-group-' + d.id);
        gridLines.select('#x-line-' + d.id)
            .attr('y1', function (d) { return yScale(d.y); })
            .attr('x2', function (d) { return xScale(d.x); })
            .attr('y2', function (d) { return yScale(d.y); });
        gridLines.select('#y-line-' + d.id)
            .attr('x1', function (d) { return xScale(d.x); })
            .attr('x2', function (d) { return xScale(d.x); })
            .attr('y2', function (d) { return yScale(d.y); });
    }
    function getPointValueText(d) {
        let string = d.x.toFixed(2) + ", " + d.y.toFixed(2);
        return string;
    }
    var line = d3.line()
        .x(function (d) { return xScale(d.x) })
        .y(function (d) { return yScale(d.y) });

    function drawSecondaryPlotElements() {
        let sortedDataX = pointData.slice(0).sort(function (a, b) {
            return d3.ascending(a.x, b.x);
        });
        let sortedDataY = pointData.slice(0).sort(function (a, b) {
            return d3.ascending(a.y, b.y);
        });
        if (pointData.length > 4) {
            drawUpdatedQuartiles(pointData, sortedDataX, sortedDataY);
            updateQuartileVisibility();
        } else {
            setQuartileVisibility(false);
        }
        if (pointData.length > 1) {
            drawUpdatedTrendLine(pointData, sortedDataX, sortedDataY);
            drawUpdatedChartLines(pointData, sortedDataX, sortedDataY);
        } else {
            plot.select("#trend-line").remove();
            plot.select("g#chart-lines").remove();
        }
        plotBackground.moveToBack();
    }
    let pcc;
    function drawUpdatedTrendLine(data, sortedDataX, sortedDataY) {
        plot.select("#trend-line").remove();
        if (trendLineActive) {
            let sumX = 0;
            let sumY = 0;
            let sumXY = 0;
            let sumXSquare = 0;
            let sumYSquare = 0;
            let n = data.length;

            for (i = 0; i < sortedDataX.length; i++) {
                sumX += sortedDataX[i].x;
                sumY += sortedDataX[i].y;
                sumXY += sortedDataX[i].x * sortedDataX[i].y;
                sumXSquare += sortedDataX[i].x * sortedDataX[i].x;
                sumYSquare += sortedDataX[i].y * sortedDataX[i].y;
            }

            let a = ((sumY * sumXSquare) - (sumX * sumXY)) / ((n * sumXSquare) - (sumX * sumX));
            let b = ((n * sumXY) - (sumX * sumY)) / ((n * sumXSquare) - (sumX * sumX));

            let trendLine = plot.append("line")
                .attr('x1', xScale(sortedDataX[0].x))
                .attr('y1', yScale(sortedDataX[0].x * b + a))
                .attr('x2', xScale(sortedDataX[sortedDataX.length - 1].x))
                .attr('y2', yScale(sortedDataX[sortedDataX.length - 1].x * b + a))
                .attr('id', 'trend-line')
                .attr('class', 'trend-line');

            trendLine.moveToBack();

            let pccNumerator = (n * sumXY) - (sumX * sumY);
            let pccDenominator = Math.sqrt(((n * sumXSquare) - (sumX * sumX)) * ((n * sumYSquare) - (sumY * sumY)));
            pcc = pccNumerator / pccDenominator;

            // document.getElementById("pcc-text").textContent = 'Pearson correlation coefficient (r): ' + pcc.toFixed(3);
        } else {
            document.getElementById("pcc-text").textContent = '';
        }
    }
    function drawUpdatedChartLines(data, sortedDataX, sortedDataY) {
        plot.select("g#chart-lines").remove();
        if (chartLinesActive) {
            let lines = plot.append('g')
                .attr('id', 'chart-lines');
            lines.append("path")
                .datum(sortedDataX)
                .attr("class", "chart-line")
                .attr("d", line);
            lines.moveToBack();
        }
    }
    function updateQuartileVisibility() {
        if (quartileActive && pointData.length > 2) {
            setQuartileVisibility(true);
        } else {
            setQuartileVisibility(false);
        }

    }
    function setQuartileVisibility(setVisible) {
        if (setVisible) {
            xQuartiles.attr('visibility', 'visible');
            yQuartiles.attr('visibility', 'visible');
            switch (currentQuartileMode) {
                case 3:
                    xAxis.attr('visibility', 'visible');
                    yAxis.attr('visibility', 'visible');
                    yQuartiles.select('.boxAndWhiskerElements').attr('visibility', 'visible');
                    xQuartiles.select('.boxAndWhiskerElements').attr('visibility', 'visible');
                    yQuartiles.select('.minimalElements').attr('visibility', 'hidden');
                    xQuartiles.select('.minimalElements').attr('visibility', 'hidden');
                    break;
                case 2:
                    xAxis.attr('visibility', 'visible');
                    yAxis.attr('visibility', 'visible');
                    yQuartiles.select('.boxAndWhiskerElements').attr('visibility', 'visible');
                    xQuartiles.select('.boxAndWhiskerElements').attr('visibility', 'hidden');
                    yQuartiles.select('.minimalElements').attr('visibility', 'hidden');
                    xQuartiles.select('.minimalElements').attr('visibility', 'hidden');
                    break;
                case 1:
                    xAxis.attr('visibility', 'visible');
                    yAxis.attr('visibility', 'visible');
                    yQuartiles.select('.boxAndWhiskerElements').attr('visibility', 'hidden');
                    xQuartiles.select('.boxAndWhiskerElements').attr('visibility', 'visible');
                    yQuartiles.select('.minimalElements').attr('visibility', 'hidden');
                    xQuartiles.select('.minimalElements').attr('visibility', 'hidden');
                    break;
                case 0:
                default:
                    xAxis.attr('visibility', 'hidden');
                    yAxis.attr('visibility', 'hidden');
                    yQuartiles.select('.boxAndWhiskerElements').attr('visibility', 'hidden');
                    xQuartiles.select('.boxAndWhiskerElements').attr('visibility', 'hidden');
                    yQuartiles.select('.minimalElements').attr('visibility', 'visible');
                    xQuartiles.select('.minimalElements').attr('visibility', 'visible');
            }
        } else {
            xAxis.attr('visibility', 'visible');
            yAxis.attr('visibility', 'visible');
            xQuartiles.attr('visibility', 'hidden');
            yQuartiles.attr('visibility', 'hidden');
            yQuartiles.select('.minimalElements').attr('visibility', 'hidden');
            xQuartiles.select('.minimalElements').attr('visibility', 'hidden');
            yQuartiles.select('.boxAndWhiskerElements').attr('visibility', 'hidden');
            xQuartiles.select('.boxAndWhiskerElements').attr('visibility', 'hidden');
        }
    }

    let lowerQuartileYValue = 0;
    let upperQuartileYValue = 0;
    let medianYValue = 0;
    let lowExtremeYValue = 0;
    let highExtremeYValue = 0;

    let lowerQuartileXValue = 0;
    let upperQuartileXValue = 0;
    let medianXValue = 0;
    let lowExtremeXValue = 0;
    let highExtremeXValue = 0;
    function drawUpdatedQuartiles(data, sortedDataX, sortedDataY) {
        if (quartileActive) {
            medianXValue = xScale(getMedianValue(sortedDataX, true));
            lowExtremeXValue = xScale(sortedDataX[0].x);
            highExtremeXValue = xScale(sortedDataX[sortedDataX.length - 1].x);

            medianX.attr('transform', `translate(${medianXValue},${plotHeight})`);
            lowExtremeX.attr('transform', `translate(${lowExtremeXValue},${plotHeight})`);
            highExtremeX.attr('transform', `translate(${highExtremeXValue},${plotHeight})`);

            lowerQuartileXValue = 0;
            upperQuartileXValue = 0;
            if (data.length % 2 == 0) {
                lowerQuartileXValue = xScale(getMedianValue(sortedDataX.slice(0, sortedDataX.length / 2 - 1), true));
                upperQuartileXValue = xScale(getMedianValue(sortedDataX.slice(sortedDataX.length / 2 + 1, sortedDataX.length), true));
                lowerQuartileX.attr('transform', `translate(${lowerQuartileXValue},${plotHeight})`);
                upperQuartileX.attr('transform', `translate(${upperQuartileXValue},${plotHeight})`);
            } else {
                lowerQuartileXValue = xScale(getMedianValue(sortedDataX.slice(0, sortedDataX.length / 2), true));
                upperQuartileXValue = xScale(getMedianValue(sortedDataX.slice(sortedDataX.length / 2 + 1, sortedDataX.length), true));
                lowerQuartileX.attr('transform', `translate(${lowerQuartileXValue},${plotHeight})`);
                upperQuartileX.attr('transform', `translate(${upperQuartileXValue},${plotHeight})`);
            }

            minimalElementsX.select('line.line-0')
                .attr('x1', lowExtremeXValue)
                .attr('y1', yScale(0))
                .attr('x2', lowerQuartileXValue)
                .attr('y2', yScale(0));
            minimalElementsX.select('line.line-1')
                .attr('x1', lowerQuartileXValue)
                .attr('y1', yScale(0) - 3)
                .attr('x2', medianXValue - 3)
                .attr('y2', yScale(0) - 3);
            minimalElementsX.select('line.line-2')
                .attr('x1', medianXValue + 3)
                .attr('y1', yScale(0) - 3)
                .attr('x2', upperQuartileXValue)
                .attr('y2', yScale(0) - 3);
            minimalElementsX.select('line.line-3')
                .attr('x1', upperQuartileXValue)
                .attr('y1', yScale(0))
                .attr('x2', highExtremeXValue)
                .attr('y2', yScale(0));

            xBox1.attr('width', medianXValue - lowerQuartileXValue);
            xBox2.attr('width', upperQuartileXValue - medianXValue);

            boxAndWhiskerLineX.attr('x1', 0)
                .attr('x2', highExtremeXValue - lowExtremeXValue);

            medianYValue = yScale(getMedianValue(sortedDataY, false));
            lowExtremeYValue = yScale(sortedDataY[0].y);
            highExtremeYValue = yScale(sortedDataY[sortedDataY.length - 1].y);

            medianY.attr('transform', `translate(0,${medianYValue})`);
            lowExtremeY.attr('transform', `translate(0,${lowExtremeYValue})`);
            highExtremeY.attr('transform', `translate(0,${highExtremeYValue})`);

            lowerQuartileYValue = 0;
            upperQuartileYValue = 0;
            if (data.length % 2 == 0) {
                lowerQuartileYValue = yScale(getMedianValue(sortedDataY.slice(0, sortedDataY.length / 2 - 1), false));
                upperQuartileYValue = yScale(getMedianValue(sortedDataY.slice(sortedDataY.length / 2 + 1, sortedDataY.length), false));
                lowerQuartileY.attr('transform', `translate(0,${lowerQuartileYValue})`);
                upperQuartileY.attr('transform', `translate(0,${upperQuartileYValue})`);
            } else {
                lowerQuartileYValue = yScale(getMedianValue(sortedDataY.slice(0, sortedDataY.length / 2), false));
                upperQuartileYValue = yScale(getMedianValue(sortedDataY.slice(sortedDataY.length / 2 + 1, sortedDataY.length), false));
                lowerQuartileY.attr('transform', `translate(0,${lowerQuartileYValue})`);
                upperQuartileY.attr('transform', `translate(0,${upperQuartileYValue})`);
            }

            minimalElementsY.select('line.line-0')
                .attr('y1', lowExtremeYValue)
                .attr('x1', xScale(0) + 1)
                .attr('y2', lowerQuartileYValue)
                .attr('x2', xScale(0) + 1);
            minimalElementsY.select('line.line-1')
                .attr('y1', lowerQuartileYValue)
                .attr('x1', xScale(0) + 3)
                .attr('y2', medianYValue + 3)
                .attr('x2', xScale(0) + 3);
            minimalElementsY.select('line.line-2')
                .attr('y1', medianYValue - 3)
                .attr('x1', xScale(0) + 3)
                .attr('y2', upperQuartileYValue)
                .attr('x2', xScale(0) + 3);
            minimalElementsY.select('line.line-3')
                .attr('y1', upperQuartileYValue)
                .attr('x1', xScale(0) + 1)
                .attr('y2', highExtremeYValue)
                .attr('x2', xScale(0) + 1);

            yBox1.attr('width', lowerQuartileYValue - medianYValue);
            yBox2.attr('width', medianYValue - upperQuartileYValue);

            boxAndWhiskerLineY.attr('y1', 0)
                .attr('y2', highExtremeYValue - lowExtremeYValue);

            xQuartiles.moveToBack();
            yQuartiles.moveToBack();
        }
    }

    function getMedianValue(data, isHorizontal) {
        if (data.length % 2 == 0) {
            let lower, higher = 0;
            if (isHorizontal) {
                lower = data[Math.floor(data.length / 2) - 1].x;
                higher = data[Math.floor(data.length / 2)].x;
            } else {
                lower = data[Math.floor(data.length / 2) - 1].y;
                higher = data[Math.floor(data.length / 2)].y;
            }
            return (lower + higher) / 2;
        } else {
            if (isHorizontal) {
                return data[Math.floor(data.length / 2)].x;
            } else {
                return data[Math.floor(data.length / 2)].y;
            }
        }
    }

    function setUpState() {
        trendLineActive = (quizID == 2);
        quartileActive = (quizID == 1);
        chartLinesActive = false;
        selectBox = document.getElementById('quartile-mode');
        currentQuartileMode = 2;
        selectBox.value = currentQuartileMode;
        setUpInput();
    }

    let answerButton;
    let nextButton;
    function setUpInput() {
        d3.select('#correlation-button')
            .on('click', function () {
                nextUrl = "https://jackbereidy.github.io/CS448B_Final_Project/Code/index.html?quizid=2&pageindex=0";
                loadNextPage();
            });
        d3.select('#box-plot-button')
            .on('click', function () {
                nextUrl = "https://jackbereidy.github.io/CS448B_Final_Project/Code/index.html?quizid=1&pageindex=0";
                loadNextPage();
            });
        answerButton = d3.select('#check-answer-button')
            .on('click', function () {
                checkAnswer();
            });
        nextButton = d3.select('#next-button')
            .on('click', loadNextPage);
        d3.select('#trend-line-checkbox')
            .property("disabled", (quizID == 2) && quizActive)
            .property('checked', trendLineActive)
            .on('change', function () {
                trendLineActive = this.checked;
                drawSecondaryPlotElements(pointData);
            });
        d3.select('#chart-lines-checkbox')
            .property('checked', chartLinesActive)
            .on('change', function () {
                chartLinesActive = this.checked;
                drawSecondaryPlotElements(pointData);
            });
        d3.select('#quartile-checkbox')
            .property("disabled", (quizID == 1) && quizActive)
            .property('checked', quartileActive)
            .on('change', function () {
                quartileActive = this.checked;
                currentQuartileMode = parseInt(selectBox.options[selectBox.selectedIndex].value);
                updateQuartileVisibility();
                drawSecondaryPlotElements(pointData);
            });
        let quartileModeSelect = d3.select('#quartile-mode')
            .on('change', function () {
                currentQuartileMode = parseInt(this.options[this.selectedIndex].value);
                if (quartileActive) {
                    updateQuartileVisibility();
                }
            });

        let domainSlider = d3.select('#domain-slider')
            .property("disabled", quizActive)
            .attr('min', chartMinX + 1)
            .attr('max', chartMaxPossible)
            .attr('value', chartCurrentX)
            .on('input', function () {
                chartCurrentX = +this.value;
                xScale = d3.scaleLinear()
                    .domain([chartMinX, chartCurrentX])
                    .range([0, plotWidth]);
                xAxis.call(d3.axisBottom(xScale));
                updateAxisStyle(xAxis, true);
                updatePointsWithNewScale();
                drawUpdatedScatterPlot(pointData);
                drawSecondaryPlotElements();
            });

        let rangeSlider = d3.select('#range-slider')
            .property("disabled", quizActive)
            .attr('min', chartMinY + 1)
            .attr('max', chartMaxPossible)
            .attr('value', chartCurrentY)
            .on('input', function () {
                chartCurrentY = +this.value;
                yScale = d3.scaleLinear()
                    .domain([chartMinY, chartCurrentY])
                    .range([plotHeight, 0]);
                yAxis.call(d3.axisLeft(yScale));
                updateAxisStyle(yAxis, false);
                updatePointsWithNewScale();
                drawUpdatedScatterPlot(pointData);
                drawSecondaryPlotElements();
            });

        updateQuartileVisibility();
    }
    function updateAxisStyle(axis, isXAxis) {
        if (isXAxis) {
            axis.selectAll(".tick text").attr("y", 12);
        } else {
            axis.selectAll(".tick text").attr("x", -12);
        }

    }
    function updatePointsWithNewScale() {
        removeAllAddRemoveButtons();
        pointData.forEach(function (point) {
            points.select('#point-group-' + point.id).select('circle')
                .attr('cx', function (d) { return xScale(point.x); })
                .attr('cy', function (d) { return yScale(point.y); });
            updateGridLineLocationForPoint(point);
        });
    }

    function loadNextPage() {
        window.location.href = nextUrl;
    }

    let numAttempts = 0;

    function checkAnswer() {
        let correct = false;
        let circles = points.selectAll('g.point-group');
        switch (quizType) {
            case 0:
                circles.each(function (d) {
                    if (d.isSolution) {
                        correct = checkQuartileAnswer(d);
                    }
                });
                break;
            case 1:
                correct = checkCorrelationAnswer();
                break;
            default:
                break;
        }
        if (correct) {
            d3.select('#skip-button').remove();
            answerButton.text("Correct!")
                .attr("class", "button button-check inactive");
            nextButton.attr("class", "button green");
            circles.each(function (d) {
                if (d.isSolution) {
                    d3.select('#point-group-' + d.id).attr('class', 'point-group uneditable-point-group')
                        .select("circle").attr('class', 'point correct-point');
                }
            });
        } else {
            numAttempts++;
            if (numAttempts == 5) {
                d3.select('#navigation-bar').insert('button', ':first-child')
                    .text('Skip Question')
                    .attr('id', 'skip-button')
                    .attr('class', 'button button-skip red')
                    .on('click', loadNextPage);
                d3.select('#message-text').attr('class', 'message-text-with-skip');
            } else if (numAttempts == 1) {
                answerButton.text("Incorrect. Check Answer Again");
            }
        }
    }

    function checkQuartileAnswer(d) {
        let compareFloat = floatComp(+d.y);
        switch (quartileQuizIndex) {
            case 0:
                if (compareFloat == floatComp(yScale.invert(lowExtremeYValue))) return true;
                break;
            case 1:
                if (compareFloat > floatComp(yScale.invert(lowExtremeYValue)) && compareFloat < floatComp(yScale.invert(lowerQuartileYValue))) return true;
                break;
            case 2:
                if (compareFloat >= floatComp(yScale.invert(lowerQuartileYValue)) && compareFloat < floatComp(yScale.invert(medianYValue))) return true;
                break;
            case 3:
                if (compareFloat == floatComp(yScale.invert(medianYValue))) return true;
                break;
            case 4:
                if (compareFloat > floatComp(yScale.invert(medianYValue)) && compareFloat <= floatComp(yScale.invert(upperQuartileYValue))) return true;
                break;
            case 5:
                if (compareFloat > floatComp(yScale.invert(upperQuartileYValue)) && compareFloat < floatComp(yScale.invert(highExtremeYValue))) return true;
                break;
            case 6:
                if (compareFloat == floatComp(yScale.invert(highExtremeYValue))) return true;
                break;
        }
        return false;
    }
    function floatComp(f) {
        return Math.floor(f * 1000);
    }

    function checkCorrelationAnswer() {
        switch (correlationQuizIndex) {
            case 0:

                if (pcc >= 0.55) return true;
                break;
            case 1:
                if (pcc < 0.55 && pcc > -0.55) return true;
                break;
            case 2:
                if (pcc <= -0.55) return true;
                break;
        }
        return false;
    }

    // moveToBack(), moveToFront() attribution: http://blockbuilder.org/eesur/4e0a69d57d3bfc8a82c2
    d3.selection.prototype.moveToBack = function () {
        return this.each(function () {
            var firstChild = this.parentNode.firstChild;
            if (firstChild) {
                this.parentNode.insertBefore(this, firstChild);
            }
        });
    };
    d3.selection.prototype.moveToFront = function () {
        return this.each(function () {
            this.parentNode.appendChild(this);
        });
    };

</script>